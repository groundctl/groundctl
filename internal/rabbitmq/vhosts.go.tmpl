// Code generated by gen.go; DO NOT EDIT.
// source: queues.yml

package rabbitmq

import (
	"fmt"

	"github.com/groundctl/groundctl/internal/config"
	amqp "github.com/rabbitmq/amqp091-go"
)

{{ range $vhost, $_ := . -}}
{{- $name := "" -}}
{{- if ne $vhost "default" -}}
	{{- $name = $vhost -}}
{{- end -}}
// {{ $vhost | camel }}Client represents and AMQP 0-9-1 client for the vhost "{{ $name }}"
// 
// Configure credentials for this vhost client in the config
type {{ $vhost | camel }}Client struct {
	*amqp.Connection
}

// Creates a new AMQP 0-9-1 client for the "{{ $name }}" vhost
func New{{ $vhost | camel }}Client() (*{{ $vhost | camel }}Client, error) {
	creds, ok := config.RabbitMQ.Credentials["{{ $vhost }}"]
	if !ok {
		return nil, fmt.Errorf("configuration missing key \"rabbitmq.credentials.{{ $vhost }}\"")
	}
	conn, err := openConnection("{{ $name }}", creds.Username, creds.Password)
	if err != nil {
		return nil, fmt.Errorf("failed to open rabbitmq connection: %w", err)
	}
	return &{{ $vhost | camel }}Client{
		conn,
	}, nil
}

{{ end }}